extern "C" __global__ void
calcGradientWeight(
	float *difference,
    float *input, 
    float *weightGradient, 
	int weightRowCount,
	int weightColumnCount,
	int inputColumnCount,
	float gradientFactor)
{
	int index = blockDim.x * blockIdx.x + threadIdx.x;
	int weightParamsCount = weightRowCount * weightColumnCount;
	
	if (index < weightParamsCount)
	{
		int y = index % weightRowCount;
        int x = index / weightRowCount;
		float sum = 0.0f;
		float temp = 0.0f;

		for(int i = 0; i < inputColumnCount; i++)
		{
			temp = input[i * weightColumnCount + x];

			if(temp != 0) 
			{
				sum += difference[i * weightRowCount + y] * temp;
			}
		}
		
		weightGradient[index] = sum * gradientFactor;
	}
}